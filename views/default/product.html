{{extend 'layout.html'}}

{{logged_in = auth.user_id is not None}}

<style>
    #product-view {
        max-width: 1000px;
        margin: auto;
    }
    #product-image {
        max-width: 400px;
        overflow: hidden;
        margin: auto;
    }
    #product-image img {
        width: 100%;
    }
    #product-edit {
        display: none;
    }
    #product-sidebar {
        padding: 10px
    }
    .product-price, .product-user {
        font-size: 100%;
    }
</style>

{{if page_type == 'create':}}
<div class="row">
    <div class="jumbotron col-lg-4">
        <h1>Add a product</h1>
        <p>The following information will be displayed along with your submission:</p>
        <p>
            <a class="label label-default product-user" href="{{=URL('store', args=auth.user.id)}}">
                <i class="fa fa-user"></i>{{=id_to_user_name(auth.user.id)}}
            </a>
        </p>
    </div>
    <div class="col-lg-8">
        {{=form}}
    </div>
</div>
{{else:}}

<div class="page-header">
    <div id="product-loaf">
        <ol class="breadcrumb">
            <li><a href="{{=URL('index')}}">Home</a></li>
            <li><a href="{{=URL('store', args=product.user_id)}}">{{=product.username}}</a></li>
            <li>{{=db.category(product.category).name}}</li>
            <li>{{=product.name}}</li>
        </ol>
    </div>
    <div class="clearfix">
        <h1 class="pull-left">{{=product.name}}</h1>
        <div class="btn-bar pull-right">
            {{if page_type == "edit":}}
            <div class='btn btn-warning edit_button'>
                Edit <i class="fa fa-pencil"></i>
            </div>
            <div class='btn btn-warning edit_button' style='display:none'>
                Cancel <i class="fa fa-times"></i>
            </div>
            <div class='btn btn-danger disable_button'>
                Mark as {{="sold" if product.status else "unsold"}} <i class="fa fa-upload"></i>
            </div>
            {{else:}}
            <div class='btn btn-success'>
                Show interest <i class="fa fa-shopping-bag"></i>
            </div>
            {{pass}}
        </div>
    </div>
</div>
<div id="product-view" class="row">
    <div id="product-image" class="col-md-4">
        {{if product.image != '':}}
        <img class="media-object" src="{{=URL('download', args=product.image)}}"/>
        {{else:}}
        <div style="background-color:#e4e4e4;width:100%;height:200px;font-size:2em;text-align:center;padding:20px">
            <p><i class="fa fa-exclamation-circle"></i> NO IMAGE</p>
        </div>
        {{pass}}
    </div>
    <div id="product-sidebar" class="col-md-8">
        <p>
            <a class="label label-default product-user" href="{{=URL('store', args=product.user_id)}}">
                <i class="fa fa-user"></i> {{=product.username}}
            </a>
        </p>
        <div class="clearfix">
            <p class="label {{='label-success' if product.status else 'label-danger'}} product-price pull-left">
                <i class="fa fa-usd"></i> {{=product.price}} {{='' if product.status else 'sold'}}
            </p>
            <p class="pull-right" title="{{=product.created_on}}"><i class="fa fa-clock-o"></i> {{=pretty_date(product.created_on)}}</p>
        </div>
        <div class="well">
            {{=product.description if product.description != "" else I(T('The product owner has not provided a description.'))}}
        </div>
    </div>
    <!--div class="media">
        {{if product.image != '':}}
        <div class="media-left" id="product-image">
            <img class="media-object" src="{{=URL('download', args=product.image)}}"/>
        </div>
        {{pass}}
        <div class="media-body">
            <h4 class="media-heading clearfix">

            </h4>
            {{if page_type == 'edit':}}
            {{pass}}
            <p>
                Posted by {{=product.username}} <small>#{{=product.user_id}}</small> on {{=product.created_on}}
            </p>
        </div>
    </div-->
</div>
<div id="product-edit">
    {{=form if form is not None else T('ERROR LOADING FORM')}}
</div>
{{pass}}

<script>
    $('.edit_button').click( function() {
        $('#product-view').toggle();
        $('#product-edit').toggle();
        $('.edit_button').toggle();
    });
</script>
