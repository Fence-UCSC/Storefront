{{extend 'layout.html'}}

{{logged_in = auth.user_id is not None}}

<style>
    body {
        background-color: #FAFAFA;
    }
    .grid-item {
        float: left;
    }
    .grid-item .thumbnail {
        overflow: hidden;
        background-color: white;
    }
    .grid-item .thumbnail img {
        width: 100%;
    }
    .product-price {
        font-size: 100%;
        float: right;
    }
}
</style>

<script>
    $( function() {
        // init Masonry
        var $grid = $('.grid').masonry({
            itemSelector: '.grid-item',
            gutter: 15
        });
        // layout Masonry after each image loads
        $grid.imagesLoaded().progress( function() {
          $grid.masonry('layout');
        });
    });
</script>

<div class="jumbotron">
    <h1>Welcome{{=(' ' + auth.user.first_name + '.') if logged_in else '!'}}</h1>
    <p>This is the homepage. There is nothing here yet, but later on we will put information here.</p>
    {{if not logged_in:}}
    <p><a class="btn btn-primary btn-lg" href="{{=URL('default', 'user/login')}}" role="button">Sign up or login</a></p>
    {{pass}}
</div>

<h2>Popular products</h2>
<div class="grid" data-masonry='{ "itemSelector": ".grid-item"}'>
    {{for product in products:}}
    <div class="grid-item col-xs-6 col-md-4 col-lg-3">
        <div class="thumbnail" onclick="window.location='{{=URL('product', args=product.id)}}'" >
            <img src="{{=URL('download', args=product.image)}}" />
            <div class="caption">
                <h3>
                    {{=product.name}}
                    <small> by
                     <a class="label label-default" href="{{=URL('store', args=product.user_id)}}">
                        <i class="fa fa-user"></i> {{=product.username}}</a>
                    </small>
                </h3>
                <div class="clearfix">
                    <p class="pull-left"><i class="fa fa-clock-o"></i> {{=pretty_date(product.created_on)}}</p>
                    <p class="label label-success product-price pull-right">${{=product.price}}</p>
                </div>
            </div>
        </div>
    </div>
    {{pass}}
</div>
