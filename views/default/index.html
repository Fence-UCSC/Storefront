{{extend 'layout.html'}}

{{logged_in = auth.user_id is not None}}

<div class="jumbotron">
    <h1>Welcome{{=(' ' + auth.user.first_name + '.') if logged_in else '!'}}</h1>
    <p>This is the homepage. There is nothing here yet, but later on we will put information here.</p>
    {{if not logged_in:}}
    <p><a class="btn btn-primary btn-lg" href="{{=URL('default', 'user/login')}}" role="button">Sign up or login</a></p>
    {{pass}}
</div>

<h2>Popular products</h2>
<div class="row">
    {{for product in products:}}
    <div class="col-md-3" id="product-{{=product.id}}">
        <div class="panel panel-default">
            <div class="panel-body">
                <div class="media">
                    {{if product.image != '':}}
                    <div class="media-left">
                        <img class="media-object" src="{{=URL('download', args=product.image)}}" style="width:100px;height:100px"/> <!-- Edit this later for material design -->
                    </div>
                    {{pass}}
                    <div class="media-body">
                        <h4 class="media-heading clearfix">
                            <span class="pull-right label label-success" style="display:inline-block">
                                ${{=product.price}}
                            </span>
                            <span class="pull-left">{{=product.name}}</span>
                        </h4>
                        {{=product.description}}
                    </div>
                </div>
            </div>
            <div class="panel-footer clearfix">
                <span class="pull-left">
                    Posted by <a href="{{=URL('default', 'user', args=[product.user_id])}}">{{=product.username}} <small>#{{=product.user_id}}</small></a> on {{=product.created_on}}
                </span>
                <span class="pull-right">

                </span>
            </div>
        </div>
    </div>
    {{pass}}
</div>

<script>
    // This is super inefficient, if someone could fix this that would be neat (AV)
    {{for product in products:}}
    $('#product-{{=product.id}}').click(function() {
        window.location = "{{=URL('default', 'product', args=product.id)}}"
    });
    {{pass}}
</script>
